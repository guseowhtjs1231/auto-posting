
{% extends 'layout.html' %}
{% block content %}
<h1>Tistory Token Get</h1>    
<form id="form__upload" method="POST" class="mt-3">
<div class="card">
    <div class="card-header">
        <h2>Requested parameter</h2>
    </div>
    <div class="form-group row">
        <div class="col-sm-10">
            <input type="hidden" name="client_id" class="form-control" value="{{ data.app_id }}" />
        </div>
    </div>
    <div class="form-group row">
        <div class="col-sm-10">
            <input type="hidden" name="client_secret" class="form-control" value="{{ data.secret_key }}" />
        </div>
    </div>
    <div class="form-group row">
        <div class="col-sm-10">
            <input type="hidden" name="redirect_uri" class="form-control" value="{{ data.call_back_url }}" />
        </div>
    </div>
    <div class="card-body">
        <p>Call back URL : {{data.call_back_url}}</p>
        <p>App ID : {{data.app_id}}</p>
        <p>Secret Key : {{data.secret_key}}</p>
        <p>App ID : {{data.app_id}}</p>
        <p>Grant Type : authorization_code</p>
        <div class="form-group row">
            <div class="col-sm-10">
                {% csrf_token %}
                <input type="text" name="code" id="id_code" value="{{ data.code }}" class="form-control" placeholder="Input code here" />
            </div>
        </div>
    </div>
    <div class="card-footer">
        <div class="col-sm-10">
            <button type="submit" class="btn btn-primary form-control">Get Token</button>
        </div>
    </div>
    <div class="form-group row">
        <div class="col-sm-10">
            
            <input type="hidden" name="grant_type" class="form-control" value="authorization_code" />
        </div>
    </div>
    
</div>
</form>
<form id="form__upload1" method="GET" class="mt-3" action="/blog/tistory/upload">
<div class="card">
    <div class="card-header">
        <h2>Log</h2>
    </div>
    <div id="id_card_body" class="card-body">
        {% csrf_token %}
        <span id="return_message" class="text-danger"></span>
    </div>
    <div class="form-group row">
        <div class="col-sm-10">
            <input type="hidden" name="access_token" id="id_access_token" class="form-control" />
        </div>
    </div>
</div>
</form>
<script>
    $(document).ready(function () {
        $("#form__upload").submit(function (event) {
            event.preventDefault();
            $.ajax({
                type: "POST",
                url: "/blog/tistory/token",
                // contentType: "application/json; charset=utf-8",
                data: {
                    'code': $('#id_code').val(),
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function (res) {
                    console.log(res)
                    $("#return_message").text(res);
                    if (res == "FAILED"){
                        return;
                    } else{
                    let upload_button = $("<input/>",{
                        type:'submit',
                        value:'Upload',
                        class : "btn btn-primary form-control"
                    })
                    $("#id_card_body").append(upload_button);
                    $("#id_access_token").val(res);
                    }
                },
                error: (error) => {
                    console.log(error.statusText)
                    console.log(error)
                }
            });
        });
    });
</script>
{% endblock %}